<div class="ag-toolbar" [class.collapsed]="state.isMinimized" [class.recording]="state.isRecording">
  <!-- 收合狀態：顯示展開按鈕 -->
  <button
    *ngIf="state.isMinimized"
    class="ag-toolbar-btn ag-btn-expand"
    (click)="onToggleMinimize()"
    title="Expand Toolbar"
  >
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <!-- 三橫線 + 菱形圖標 -->
      <line x1="4" y1="6" x2="14" y2="6"/>
      <line x1="4" y1="12" x2="14" y2="12"/>
      <line x1="4" y1="18" x2="14" y2="18"/>
      <path d="M17 9l3 3-3 3" fill="none"/>
    </svg>
  </button>

  <!-- 展開狀態：顯示完整工具列 -->
  <ng-container *ngIf="!state.isMinimized">
    <!-- 標記計數徽章 -->
    <div class="ag-marker-badge" *ngIf="hasMarkers">
      {{ markerCount }}
    </div>

    <!-- 主工具列 -->
    <div class="ag-toolbar-buttons">
      <!-- 錄製按鈕 -->
      <button
        class="ag-toolbar-btn ag-btn-record"
        [class.active]="state.isRecording"
        (click)="onToggleRecording()"
        [title]="state.isRecording ? 'Stop Recording' : 'Start Recording'"
      >
        <svg *ngIf="!state.isRecording" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
        </svg>
        <svg *ngIf="state.isRecording" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="6" width="12" height="12" rx="2"/>
        </svg>
      </button>

      <!-- 檢視標記 -->
      <button
        class="ag-toolbar-btn"
        [class.active]="state.showMarkers"
        [disabled]="!hasMarkers"
        (click)="onToggleMarkers()"
        title="View Markers"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/>
        </svg>
      </button>

      <!-- 複製 -->
      <button
        class="ag-toolbar-btn"
        [disabled]="!hasMarkers"
        (click)="onCopy()"
        title="Copy to Clipboard"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
      </button>

      <!-- 清除 -->
      <button
        class="ag-toolbar-btn"
        [disabled]="!hasMarkers"
        (click)="onClear()"
        title="Clear Markers"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
      </button>

      <!-- 分隔線 -->
      <div class="ag-toolbar-divider"></div>

      <!-- 設定 -->
      <button
        class="ag-toolbar-btn"
        [class.active]="state.showSettings"
        (click)="onToggleSettings()"
        title="Settings"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>

      <!-- 收合按鈕 -->
      <button
        class="ag-toolbar-btn ag-btn-collapse"
        (click)="onToggleMinimize()"
        title="Collapse Toolbar"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="4" y1="6" x2="14" y2="6"/>
          <line x1="4" y1="12" x2="14" y2="12"/>
          <line x1="4" y1="18" x2="14" y2="18"/>
          <path d="M20 9l-3 3 3 3"/>
        </svg>
      </button>
    </div>
  </ng-container>

  <!-- Settings Panel -->
  <ag-settings-panel
    *ngIf="state.showSettings"
    [settings]="settings"
    (settingsChange)="settingsChange.emit($event)"
    (closed)="onToggleSettings()"
  ></ag-settings-panel>
</div>
